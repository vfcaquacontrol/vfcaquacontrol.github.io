var topicDsBrd="IoT/AquaControl/Dashboard",topicCmd="IoT/AquaControl/Commands",mqttURI="",mqttHost=localStorage.getItem("mqttHost")||"iot.eclipse.org",mqttPort=Number(localStorage.getItem("mqttPort")||443),mqttPath="/ws",mqttUser=localStorage.getItem("mqttUser")||"",mqttPwd=localStorage.getItem("mqttPwd")||"",mqttUseSSL=!0,mqttVersion=4,mqttTimeout=5,saveConfigButton=document.getElementById("btnSaveConfig"),reconnectButton=document.getElementById("btnReconnect"),recebendo=!1;$("#configHost").val(mqttHost),$("#configPort").val(mqttPort),$("#configUser").val(mqttUser),$("#configPwd").val(mqttPwd);var client,options={onSuccess:mqtt_OnConnect,onFailure:mqtt_OnFailure,useSSL:mqttUseSSL,mqttVersion:mqttVersion,timeout:mqttTimeout,userName:mqttUser,password:mqttPwd},jsonMsg={cmd:null,value:null};function myclientid(){return"myclientid_"+parseInt(100*Math.random(),10)}$(document).ready(function(){$(".GaugeMeter").gaugeMeter(),mqtt_Connect(),$("#a1_luz").change(function(){$("#a1_luz").val($(this).is(":checked"))}),$("#a2_luz").change(function(){$("#a2_luz").val($(this).is(":checked"))}),$("#a1_luz").click(function(){if(recebendo)return!0;var t;$(this).is(":checked")?((t=jsonMsg).cmd="a1-luz-on",t.value="true",mqtt_Publish_Cmd(t)):((t=jsonMsg).cmd="a1-luz-on",t.value="false",mqtt_Publish_Cmd(t));return!0}),$("#a2_luz").click(function(){if(recebendo)return!0;var t;$(this).is(":checked")?((t=jsonMsg).cmd="a2-luz-on",t.value="true",mqtt_Publish_Cmd(t)):((t=jsonMsg).cmd="a2-luz-on",t.value="false",mqtt_Publish_Cmd(t));return!0})}),(client=""!=mqttURI?new Paho.MQTT.Client(mqttURI,"myclientid_"+myclientid()):new Paho.MQTT.Client(mqttHost,mqttPort,mqttPath,myclientid())).onConnectionLost=function(t){mqtt_All_PrintMsg("connection lost: "+t.errorMessage)},client._disconnected=function(){mqtt_All_PrintMsg("disconnected")},client.onMessageArrived=function(t){recebendo=!0;try{var e;e=JSON.parse(t.payloadString),t.destinationName==topicDsBrd?"a1-temp"==e.cmd?mqtt_A1_PrintTemp(e.value):"a2-temp"==e.cmd?mqtt_A2_PrintTemp(e.value):"a1-luz-on"==e.cmd?$("#a1_luz").prop("checked","true"==e.value):"a2-luz-on"==e.cmd&&$("#a2_luz").prop("checked","true"==e.value):console.log("tópico não encontrado: "+t.destinationName)}catch(t){console.log("Error: "+t+".")}finally{recebendo=!1}};var publish=function(t,e,n){t=JSON.stringify(t);var o=new Paho.MQTT.Message(t);o.destinationName=e,o.qos=n,client.send(o)};function mqtt_Reconnect(){location.reload(!1)}function mqtt_Connect(){mqtt_All_PrintMsg("Conectando..."),client.connect(options)}function mqtt_OnConnect(){mqtt_All_PrintMsg("Conectado"),mqtt_Subscribe()}function mqtt_OnFailure(t){mqtt_All_PrintMsg("Falha conexão: "+t.errorMessage)}function mqtt_Subscribe(){client.subscribe(topicDsBrd,{qos:2,onSuccess:callBack_OnSubscribe})}function callBack_OnSubscribe(t,e){mqtt_A1_PrintMsg("Pronto"),mqtt_A2_PrintMsg("Pronto"),setTimeout(function(){mqtt_Publish_InitialCmd()},500)}function mqtt_Publish_InitialCmd(){var t=jsonMsg;t.cmd="initvalues",t.value="true",publish(t,topicCmd,2)}function mqtt_Publish_Cmd(t){publish(t,topicCmd,2)}function mqtt_Disconnect(){try{client.disconnect()}catch(t){}}function mqtt_All_PrintMsg(t){mqtt_A1_PrintMsg(t),mqtt_A2_PrintMsg(t)}function mqtt_A1_PrintMsg(t){$("#divlogs").prepend("<span>A1: "+t+"</span><br/>"),$("#a1_msg").val(t)}function mqtt_A1_PrintTemp(t){$("#divlogs").prepend("<span>A1: "+t+"</span><br/>"),$("#GaugeA1Temp").gaugeMeter({showvalue:!0,used:Number(t),total:50})}function mqtt_A2_PrintMsg(t){$("#divlogs").prepend("<span>A2: "+t+"</span><br/>"),$("#a2_msg").val(t)}function mqtt_A2_PrintTemp(t){$("#divlogs").prepend("<span>A2: "+t+"</span><br/>"),$("#GaugeA2Temp").gaugeMeter({showvalue:!0,used:Number(t),total:50})}var saveConfig=function(){return localStorage.setItem("mqttHost",$("#configHost").val()),localStorage.setItem("mqttPort",$("#configPort").val()),localStorage.setItem("mqttUser",$("#configUser").val()),localStorage.setItem("mqttPwd",$("#configPwd").val()),location.reload(!1)};reconnectButton.addEventListener("click",mqtt_Reconnect),saveConfigButton.addEventListener("click",saveConfig);